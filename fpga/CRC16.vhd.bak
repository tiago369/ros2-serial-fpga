entity CRC16 is
    port (
        clk      : in  std_logic;
        reset    : in  std_logic;
        data_in  : in  std_logic;
        crc_in   : in  std_logic_vector(15 downto 0);
        crc_out  : out std_logic_vector(15 downto 0)
    );
end entity CRC16;

architecture rtl of CRC16 is
begin
    process (clk)
        variable temp : std_logic_vector(15 downto 0);
    begin
        if rising_edge(clk) then
            if reset = '1' then
                temp := (others => '0');
            else
                temp := crc_in;
                temp(0) := temp(0) xor data_in;
                for i in 0 to 7 loop
                    if temp(0) = '1' then
                        temp := temp(14 downto 0) & '0' xor "1100000000000010";
                    else
                        temp := '0' & temp(14 downto 0) xor "0000000000000000";
                    end if;
                end loop;
            end if;
            crc_out <= temp;
        end if;
    end process;
end architecture rtl;
